{% extends "app.html" %} {% load static %} {% block title %}Payment
Selection{%endblock %} {% block content %}

<div class="container py-4">
  <div class="row g-5">
    <div class="col-md-5 col-lg-4 order-md-last">
      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-light">Your cart</span>
        <span class="badge bg-primary rounded-pill">3</span>
      </h4>
      {% if cart|length == 0 %}
      <div><p>No product in the cart</p></div>
      {% else %}
      <ul class="list-group mb-3">
        {% for item in cart %} {% with product=item.product %}
        <li class="list-group-item d-flex justify-content-between lh-sm">
          <div>
            <h6 class="my-0">{{product.title}}</h6>
          </div>
          <span class="text-muted">{{item.quantity}}</span>
        </li>
        {% endwith %} {% endfor %}
  
        <li class="list-group-item d-flex justify-content-between lh-sm">
          <div>
            <h6 class="my-0">Sub Total</h6>
            <small class="text-muted"></small>
          </div>
          <span class="text-muted">${{cart.get_subtotal_price}}</span>
        </li>
        <li class="list-group-item d-flex justify-content-between bg-light">
          <div class="text-success">
            <h6 class="my-0">Delivery Cost</h6>
          </div>
          <span class="text-success">+${{cart.get_delivery_price}}</span>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span>Total (USD)</span>
          <strong>${{cart.get_total_price}}</strong>
        </li>
      </ul>
      {% endif %}
    </div>
    <div class="col-md-7 col-lg-8">
      <div id="payment-form">
        <h3 class="mb-3 text-light">Billing address</h3>
        <!-- Error messages in this element -->
        <div id="card-errors" class="a" role="alert"></div>
        <form>
          <div class="row g-3">
            <div class="col-sm-7">
              <label for="firstName" class="form-label text-light">Customer Name</label>
              <input
                type="text"
                class="form-control"
                id="customerName"
                placeholder=""
                required
              />
              <div class="invalid-feedback">Valid first name is required.</div>
            </div>
            <div class="col-12">
              <label for="email" class="form-label text-light"
                >Email <span class="text-muted">(Optional)</span></label
              >
              <input
                type="email"
                class="form-control"
                id="email"
                placeholder="you@example.com"
              />
              <div class="invalid-feedback">
                Please enter a valid email address for shipping updates.
              </div>
            </div>
            <div class="col-12">
              <label for="phone" class="form-label text-light">Phone</label>
              <input
                type="text"
                class="form-control"
                id="customerPhone"
                placeholder="xxx xxx xx xx"
                required
              />
              <div class="invalid-feedback">Please enter your phone number.</div>
            </div>
            <div class="col-12">
              <label for="address" class="form-label text-light">Address</label>
              <input
                type="text"
                class="form-control"
                id="customerAddress"
                placeholder="1234 Main St"
                required
              />
              <div class="invalid-feedback">
                Please enter your shipping address.
              </div>
            </div>
            <div class="col-12">
              <label for="address2" class="form-label text-light"
                >Address 2 <span class="text-muted">(Optional)</span></label
              >
              <input
                type="text"
                class="form-control"
                id="customerAddress2"
                placeholder="Apartment or suite"
              />
            </div>
            <div class="col-md-4">
              <label for="city" class="form-label text-light">City</label>
              <select class="form-select" id="city" required>
                <option value="">Choose...</option>
                {% for city in cities %}
                <option value="{{city.name}}">{{city.name}}</option>
                {% endfor %}
              </select>
              <div class="invalid-feedback">Please provide a valid state.</div>
            </div>
            <div class="col-md-3">
              <label for="Postcode" class="form-label text-light">Postcode</label>
              <input
                type="text"
                class="form-control"
                id="postCode"
                placeholder=""
                required
              />
              <div class="invalid-feedback">Zip code required.</div>
            </div>
          </div>
          <hr class="my-4" />
          <h4 class="mb-3 text-light">Payment</h4>
          <label for="card-element text-light">Credit card</label>
          <div id="card-element" class="form-control form-control-payment">
            <!-- Payment elements will appear here -->
          </div>
          <hr class="my-4" />
          <button
            id="submit"
            class="btn btn-primary w-100 fw-bold"
            data-secret="{{ paymentData.client_secret }}"
          >
            Pay
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %} {% block scripts %} {% if request.GET.payment_type == "paypal" %}
<script>
  console.log("paypal");
</script>
{% else %}
<script>
  var STRIPE_PUBLISHABLE_KEY = "{{paymentInstance.publishable_key}}";
  var CSRF_TOKEN = "{{ csrf_token }}";

  // Example starter JavaScript for disabling form submissions if there are invalid fields
  (() => {
    "use strict";

    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    const forms = document.querySelectorAll(".needs-validation");

    // Loop over them and prevent submission
    Array.from(forms).forEach((form) => {
      form.addEventListener(
        "submit",
        (event) => {
          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
          }

          form.classList.add("was-validated");
        },
        false
      );
    });
  })();
</script>
<script src="https://js.stripe.com/v3/"></script>
<script src="{% static 'js/payment.js' %}" data-rel-js></script>
{% endif %} {% endblock %}
